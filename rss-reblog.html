<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>RSS-Reblog</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <script>
    
  srcFeed = {url:null, guid:null};
  srcItem = null;
    
  window.onload = function() {
    
    errorSpan = document.getElementById("error")
    
    //1. Autofill the source feed and source guid.
    
    pageURL = "rssr.dev/reblog?&feed=https%3A%2F%2Fwww.bluetinge.dev%2Frss.xml&guid=https%3A%2F%2Fbluetinge.github.io%2Fregex-crossword%2F8"; //sample
    // let pageURL = window.location.href; //uncomment to use actual URL
    
    searchParams = new URLSearchParams(pageURL);
    srcFeed.url = searchParams.get("feed");
    srcFeed.guid = searchParams.get("guid");

    errorSpan.innerHTML = "\nFeed:"+srcFeed.url + "\n" + "GUID:"+srcFeed.guid;

    //  1.2 Attempt to load the source feed
    //var srcFeed = "https://feeds.feedburner.com/raymondcamdensblog?format=xml";
    $.ajax({
      type: 'GET',
      url: "https://api.rss2json.com/v1/api.json?rss_url=" + srcFeed.url,
      dataType: 'jsonp',
      success: function(result) {
        srcFeed.json = result;
        loadSrc();
      },
      error: function(result) {
        errorSpan.innerHTML = "Error: a feed could not be derived from "+srcFeed.url;
        console.log("ERROR:")
        console.log(result);
      }
    });

  }

    //2. From the source feed, determine if the guid can be found. Load the source pfp and name.
  
  loadSrc = function() {
    console.log(srcFeed.json);
    srcItem = null;
    for ( item of srcFeed.json.items) {
      if (srcFeed.guid === item.guid){
        if (srcItem != null) {
          errorSpan.innerHTML = "Error: GUID occurs multiple times in feed";
          return;
        }
        srcItem = item;
      }
    }
    if (srcItem == null) {
      errorSpan.innerHTML = "Error: GUID not in feed";
      return;
    }
    
    srcFeed.title = srcFeed.json.feed.title;
    
    //feed loaded correctly
    // now to fill vars on page
    
    document.getElementById("srcItemTitle").innerHTML = srcItem.title;
    document.getElementById("srcFeedTitle").innerHTML = srcFeed.title;
    
     
  }

    //3. Prompt the user for their feed (link or file)
    //4. On load, display the determined username and pfp, and a preview of the post and tags. 
    //5. Optionally, the user may alter the username or pfp.
         //5a. The user may check a box to save their display name or pfp in their feed for the future.
    //6. Optionally, the user may add content.
    //7. Optionally, the user may add or remove tags.
    //8. Optionally, the user may adjust security settings.
    //9.Optionally, the user may specify the GUID or link.
    //10. The user clicks generate, and the file is created.
    //11. A final preview is created. 
    //12. The user may download or copy the feed (as an RSS/XML file)
    //13. The user may download or copy the post (as an html file or a markdown file

  </script>


</head>
<body>
  <div class="container">
  
    <p>Demo: <span id="error"></span> </p>
  
    <h3>Reblogging <b id="srcItemTitle">Title</b> from ""<b id="srcFeedTitle">Feed</b>":</h3>

    <p>Reblog this post to your RSS feed:</p>
 
    <div>
<!--( ) Link to your RSS feed XML file: [ Text box ] -->
      <input type="radio" id="link" name="howInputJS" value="link">
      <label for="link"> <form action="javascript:;" onsubmit=" myFunction( this ) "> Get from link:  <input type="text" id="destLink" name="destLink"> <input type="submit" value="Look up"></form></label><br>

<!--   ( ) Upload your RSS feed XML file [ Select file ] -->
      <input type="radio" id="upload" name="howInputJS" value="upload">
      <label for="upload"><label for="destFile">Upload: </label> <input type="file" id="destFile" name="destFile"> </label><br>


      <p> Error box / Results box </p>
    </div>

    Your profile will be displayed as: [I] [ Text box ]
        [  ] Save this display name within your feed as the default to be used by RSS-Reblog

    Unique link to your reblog of this post (optional): [ Text box ]

    Add something (optional):
    [ Text box ]
    ( ) Markdown ( ) HTML5

    Modify tags (optional):
    [ Text box ] 
    All reblogs are also tagged “reblog.”

    Security options:
    ( ) Remove all JavaScript and CSS
    (•) Remove all JavaScript and CSS except [allowed inline style attributes]
    ( ) Remove all JavaScript, keep all CSS
    ( ) Keep all CSS and JavaScript (Warning – security risks! Enable at your own risk)

    Unique name: [ Text box ]

    [ Generate ]

    Preview pane
    Note: external scripting disabled in preview pane for security reasons.
    Tabs: View preview | View as markdown | View as HTML | View as RSS

    [ Download RSS ]

    [ ] Enable cookies to store my default preferences (Note: will not default to unsafe security preferences.)
  
  
  </div>
</body>
</html>


