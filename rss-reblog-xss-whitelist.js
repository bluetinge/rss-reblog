// Whitelisted tags for use with https://github.com/leizongmin/js-xss

// Based on a couple sources, including:
// - the default whitelist for js-xss: filterXSS.getDefaultWhiteList(), filterXSS.getDefaultCSSWhiteList()
// - the style tag whitelist for the RSS validator here: https://validator.w3.org/feed/docs/warning/DangerousStyleAttr.html
// - the default whitelist for HtmlSanitizer, minus anything related to input/forms: https://github.com/mganss/HtmlSanitizer
//    - Note: I excluded a some parts of this whitelist, including anything related to input/forms. I can add those back in if it seems safe and there is a need

// Most potentially problematic aspect is allowing the class attribute, which could theoretically be used for classjacking: https://html5sec.org/#123
// I've included them for a couple reasons:
// - They make processing the RSS-Reblog headers and footers a *lot* easier
// - They allow a neat opt-in way for reblogged posts to preserve advanced style content (for example, a reblogged post might take advantage of Bootstrap styling, but with no real disadvantage if the hosting blog doesn't include Bootstrap). 
// - I couldn't find any relevant examples of classjacking, and what content I did find wasn't particularly compelling. They don't really enable cross-site-scriptinng, since by definition they can't add any code -- only provide handles to be manipulated by existing scripts. In theory a malicious post could take advantage of existing scripts to e.g. impersonate a host site's content, but the fact that the post cannot include any form or script elements, etc. means the ultimate effect of this is limited. It's about as dangerous as allowing posts to include links, frankly.
// - I'll remove it if someone can find me a compelling reason, though

// An additional potentially problematic aspect is comments. 
//  At the moment, I remove all comments but what I would like to do is:
//    keep all comments, but remove characters that are not within /[a-zA-Z0-9,\.\?\! \n]/
//  This should remove anything dangerous, but if someone disagrees contact me and I can revise.

// Usage:
// Create with rssrXSS = new filterXSS.FilterXSS(rssReblogXSSOptions);
// Use with outputStr = rssrXSS.process(inputStr);

rssReblogXSSOptions = {
  "whiteList": {
    "a":["class","style","target","href","title"],
    "abbr":["class","style","title"],
      "acronym":["class","style"],
    "address":["class","style"],
    "area":["class","style","shape","coords","href","alt"],
    "article":["class","style"],
    "aside":["class","style"],
    "audio":["class","style","autoplay","controls","crossorigin","loop","muted","preload","src"],
    "b":["class","style"],
    "bdi":["class","style","dir"],
    "bdo":["class","style","dir"],
    "big":["class","style"],
    "blockquote":["class","style","cite"],
    "br":["class","style"],
    "caption":["class","style"],
    "center":["class","style"],
    "cite":["class","style"],
    "code":["class","style"],
    "col":["class","style","align","valign","span","width"],
    "colgroup":["class","style","align","valign","span","width"],
      "data":["class","style"],
      "datalist":["class","style"],
    "dd":["class","style"],
    "del":["class","style","datetime"],
    "details":["class","style","open"],
      "dfn":["class","style"],
      "dir":["class","style"],
    "div":["class","style"],
    "dl":["class","style"],
    "dt":["class","style"],
    "em":["class","style"],
      "fieldset":["class","style"],
    "figcaption":["class","style"],
    "figure":["class","style"],
    "font":["class","style","color","size","face"],
    "footer":["class","style"],
    "h1":["class","style"],
    "h2":["class","style"],
    "h3":["class","style"],
    "h4":["class","style"],
    "h5":["class","style"],
    "h6":["class","style"],
    "header":["class","style"],
    "hr":["class","style"],
    "i":["class","style"],
    "img":["class","style","src","alt","title","width","height","loading", "max-width", "max-height"],
    "ins":["class","style","datetime"],
    "kbd":["class","style"],
      "label":["class","style"],
      "legend":["class","style"],
    "li":["class","style"],
      "map":["class","style"],
    "mark":["class","style"],
      "menu":["class","style"],
      "menuitem":["class","style"],
      "meter":["class","style","min","max","value"],
    "nav":["class","style"],
    "ol":["class","style"],
    "p":["class","style"],
    "pre":["class","style"],
      "progress":["class","style","min","max","value"],
      "q":["class","style"],
      "rp":["class","style"],
      "rt":["class","style"],
      "ruby":["class","style"],
    "s":["class","style"],
      "samp":["class","style"],
    "section":["class","style"],
    "small":["class","style"],
    "span":["class","style"],
    "sub":["class","style"],
    "summary":["class","style"],
    "sup":["class","style"],
    "strong":["class","style"],
    "strike":["class","style"],
    "table":["class","style","width","border","align","valign"],
    "tbody":["class","style","align","valign"],
    "td":["class","style","width","rowspan","colspan","align","valign"],
    "tfoot":["class","style","align","valign"],
    "th":["class","style","width","rowspan","colspan","align","valign"],
    "thead":["class","style","align","valign"],
      "time":["class","style","datetime"],
    "tr":["class","style","rowspan","align","valign"],
    "tt":["class","style"],
    "u":["class","style"],
    "ul":["class","style"],
      "var":["class","style"],
    "video":["class","style","autoplay","controls","crossorigin","loop","muted","playsinline","poster","preload","src","height","width"],
      "wbr":["class","style"]
  },
  "css": {
    "whiteList": {
      "align-content":false,
      "align-items":false,
      "align-self":false,
      "alignment-adjust":false,
      "alignment-baseline":false,
      "all":false,
      "anchor-point":false,
      "animation":false,
      "animation-delay":false,
      "animation-direction":false,
      "animation-duration":false,
      "animation-fill-mode":false,
      "animation-iteration-count":false,
      "animation-name":false,
      "animation-play-state":false,
      "animation-timing-function":false,
      "azimuth":true,
      "backface-visibility":false,
      "background":true,
      "background-attachment":true,
      "background-clip":true,
      "background-color":true,
      "background-image":true,
      "background-origin":true,
      "background-position":true,
      "background-repeat":true,
      "background-size":true,
      "baseline-shift":false,
      "binding":false,
      "bleed":false,
      "bookmark-label":false,
      "bookmark-level":false,
      "bookmark-state":false,
      "border":true,
      "border-bottom":true,
      "border-bottom-color":true,
      "border-bottom-left-radius":true,
      "border-bottom-right-radius":true,
      "border-bottom-style":true,
      "border-bottom-width":true,
      "border-collapse":true,
      "border-color":true,
      "border-image":true,
      "border-image-outset":true,
      "border-image-repeat":true,
      "border-image-slice":true,
      "border-image-source":true,
      "border-image-width":true,
      "border-left":true,
      "border-left-color":true,
      "border-left-style":true,
      "border-left-width":true,
      "border-radius":true,
      "border-right":true,
      "border-right-color":true,
      "border-right-style":true,
      "border-right-width":true,
      "border-spacing":true,
      "border-style":true,
      "border-top":true,
      "border-top-color":true,
      "border-top-left-radius":true,
      "border-top-right-radius":true,
      "border-top-style":true,
      "border-top-width":true,
      "border-width":true,
      "bottom":false,
      "box-decoration-break":true,
      "box-shadow":true,
      "box-sizing":true,
      "box-snap":true,
      "box-suppress":true,
      "break-after":true,
      "break-before":true,
      "break-inside":true,
      "caption-side":false,
      "chains":false,
      "clear":true,
      "clip":false,
      "clip-path":false,
      "clip-rule":false,
      "color":true,
      "color-interpolation-filters":true,
      "column-count":false,
      "column-fill":false,
      "column-gap":false,
      "column-rule":false,
      "column-rule-color":false,
      "column-rule-style":false,
      "column-rule-width":false,
      "column-span":false,
      "column-width":false,
      "columns":false,
      "contain":false,
      "content":false,
      "counter-increment":false,
      "counter-reset":false,
      "counter-set":false,
      "crop":false,
      "cue":false,
      "cue-after":false,
      "cue-before":false,
      "cursor":true,
      "direction":true,
      "display":true,
      "display-inside":true,
      "display-list":true,
      "display-outside":true,
      "dominant-baseline":false,
      "elevation":true,
      "empty-cells":false,
      "filter":false,
      "flex":false,
      "flex-basis":false,
      "flex-direction":false,
      "flex-flow":false,
      "flex-grow":false,
      "flex-shrink":false,
      "flex-wrap":false,
      "float":true,
      "float-offset":true,
      "flood-color":false,
      "flood-opacity":false,
      "flow-from":false,
      "flow-into":false,
      "font":true,
      "font-family":true,
      "font-feature-settings":true,
      "font-kerning":true,
      "font-language-override":true,
      "font-size":true,
      "font-size-adjust":true,
      "font-stretch":true,
      "font-style":true,
      "font-synthesis":true,
      "font-variant":true,
      "font-variant-alternates":true,
      "font-variant-caps":true,
      "font-variant-east-asian":true,
      "font-variant-ligatures":true,
      "font-variant-numeric":true,
      "font-variant-position":true,
      "font-weight":true,
      "grid":false,
      "grid-area":false,
      "grid-auto-columns":false,
      "grid-auto-flow":false,
      "grid-auto-rows":false,
      "grid-column":false,
      "grid-column-end":false,
      "grid-column-start":false,
      "grid-row":false,
      "grid-row-end":false,
      "grid-row-start":false,
      "grid-template":false,
      "grid-template-areas":false,
      "grid-template-columns":false,
      "grid-template-rows":false,
      "hanging-punctuation":false,
      "height":true,
      "hyphens":false,
      "icon":false,
      "image-orientation":false,
      "image-resolution":false,
      "ime-mode":false,
      "initial-letters":false,
      "inline-box-align":false,
      "justify-content":false,
      "justify-items":false,
      "justify-self":false,
      "left":false,
      "letter-spacing":true,
      "lighting-color":true,
      "line-box-contain":false,
      "line-break":false,
      "line-grid":false,
      "line-height":true,
      "line-snap":false,
      "line-stacking":false,
      "line-stacking-ruby":false,
      "line-stacking-shift":false,
      "line-stacking-strategy":false,
      "list-style":true,
      "list-style-image":true,
      "list-style-position":true,
      "list-style-type":true,
      "margin":true,
      "margin-bottom":true,
      "margin-left":true,
      "margin-right":true,
      "margin-top":true,
      "marker-offset":false,
      "marker-side":false,
      "marks":false,
      "mask":false,
      "mask-box":false,
      "mask-box-outset":false,
      "mask-box-repeat":false,
      "mask-box-slice":false,
      "mask-box-source":false,
      "mask-box-width":false,
      "mask-clip":false,
      "mask-image":false,
      "mask-origin":false,
      "mask-position":false,
      "mask-repeat":false,
      "mask-size":false,
      "mask-source-type":false,
      "mask-type":false,
      "max-height":true,
      "max-lines":false,
      "max-width":true,
      "min-height":true,
      "min-width":true,
      "move-to":false,
      "nav-down":false,
      "nav-index":false,
      "nav-left":false,
      "nav-right":false,
      "nav-up":false,
      "object-fit":false,
      "object-position":false,
      "opacity":false,
      "order":false,
      "orphans":false,
      "outline":false,
      "outline-color":false,
      "outline-offset":false,
      "outline-style":false,
      "outline-width":false,
      "overflow":true,
      "overflow-wrap":true,
      "overflow-x":true,
      "overflow-y":true,
      "padding":true,
      "padding-bottom":true,
      "padding-left":true,
      "padding-right":true,
      "padding-top":true,
      "page":false,
      "page-break-after":false,
      "page-break-before":false,
      "page-break-inside":false,
      "page-policy":false,
      "pause":true,
      "pause-after":true,
      "pause-before":true,
      "perspective":false,
      "perspective-origin":false,
      "pitch":true,
      "pitch-range":true,
      "play-during":false,
      "position":false,
      "presentation-level":false,
      "quotes":false,
      "region-fragment":false,
      "resize":false,
      "rest":false,
      "rest-after":false,
      "rest-before":false,
      "richness":true,
      "right":false,
      "rotation":false,
      "rotation-point":false,
      "ruby-align":false,
      "ruby-merge":false,
      "ruby-position":false,
      "shape-image-threshold":false,
      "shape-outside":false,
      "shape-margin":false,
      "size":false,
      "speak":true,
      "speak-as":true,
      "speak-header":true,
      "speak-numeral":true,
      "speak-punctuation":true,
      "speech-rate":true,
      "stress":true,
      "string-set":false,
      "tab-size":false,
      "table-layout":false,
      "text-align":true,
      "text-align-last":true,
      "text-combine-upright":true,
      "text-decoration":true,
      "text-decoration-color":true,
      "text-decoration-line":true,
      "text-decoration-skip":true,
      "text-decoration-style":true,
      "text-emphasis":true,
      "text-emphasis-color":true,
      "text-emphasis-position":true,
      "text-emphasis-style":true,
      "text-height":true,
      "text-indent":true,
      "text-justify":true,
      "text-orientation":true,
      "text-overflow":true,
      "text-shadow":true,
      "text-space-collapse":true,
      "text-transform":true,
      "text-underline-position":true,
      "text-wrap":true,
      "top":false,
      "transform":false,
      "transform-origin":false,
      "transform-style":false,
      "transition":false,
      "transition-delay":false,
      "transition-duration":false,
      "transition-property":false,
      "transition-timing-function":false,
      "unicode-bidi":true,
      "vertical-align":true,
      "visibility":false,
      "voice-balance":false,
      "voice-duration":false,
      "voice-family":true,
      "voice-pitch":false,
      "voice-range":false,
      "voice-rate":false,
      "voice-stress":false,
      "voice-volume":false,
      "volume":true,
      "white-space":true,
      "widows":false,
      "width":true,
      "will-change":false,
      "word-break":true,
      "word-spacing":true,
      "word-wrap":true,
      "wrap-flow":false,
      "wrap-through":false,
      "writing-mode":false,
      "z-index":true
    }
  },
  "stripIgnoreTag":true,
  "stripIgnoreTagBody":['head','link','script','style','iframe'],
  // "stripCommentTag": function (html) {
    // var retHtml = "";
    // var lastPos = 0;
    // while (lastPos < html.length) {
      // var i = html.indexOf("<!--", lastPos);
      // if (i === -1) {
        // retHtml += html.slice(lastPos).replace("<!--","&lt;!--").replace("-->","--&gt;");
        // break;
      // }
      // retHtml += html.slice(lastPos, i).replace("<!--","&lt;!--").replace("-->","--&gt;");
      // var j = html.indexOf("-->", i);
      // if (j === -1) {
        // break;
      // }
      // retHtml += "<!--"+html.slice(i + 4,j).replace(/[^a-zA-Z0-9,\.\?\! \n]/g,"")+"-->";
      // lastPos = j + 3;
    // }
    // return retHtml;
  // },
  // "escapeHtml": function (html) {
    // return html.replace(/<(?!!--)/g, "&lt;").replace(/(?<!--)>/g, "&gt;");
  // }
}


// used to filter the text before conversion from html to markdown
markdownXSSOptions = {
  "whiteList": {
    "a":["class","style","target","href","title"],
    "b":["class","style"],
    "blockquote":["class","style","cite"],
    "br":["class","style"],
    "code":["class","style"],
    "del":["class","style","datetime"],
    "em":["class","style"],
    "h1":["class","style"],
    "h2":["class","style"],
    "h3":["class","style"],
    "h4":["class","style"],
    "h5":["class","style"],
    "h6":["class","style"],
    "hr":["class","style"],
    "i":["class","style"],
    "img":["class","style","src","alt","title","width","height","loading"],
    "li":["class","style"],
    "ol":["class","style"],
    "p":["class","style"],
    "pre":["class","style"],
    "strong":["class","style"],
    "table":["class","style","width","border","align","valign"],
    "tbody":["class","style","align","valign"],
    "td":["class","style","width","rowspan","colspan","align","valign"],
    "tfoot":["class","style","align","valign"],
    "th":["class","style","width","rowspan","colspan","align","valign"],
    "thead":["class","style","align","valign"],
    "tr":["class","style","rowspan","align","valign"],
    "u":["class","style"],
    "ul":["class","style"],
  },
  "css": false,
  "stripIgnoreTag":true,
  "stripIgnoreTagBody":['head','link','script','style','iframe'],
}
